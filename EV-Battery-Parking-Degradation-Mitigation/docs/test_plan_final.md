# EV電池放置劣化軽減 - 最終テスト計画書

## 追加テストケース詳細

### TC011: 充電中にIG-ON更新（移動なしパターン） (VIN001)
**目的**: 充電中のIG-ON更新で移動が発生しない場合の処理テスト
**シナリオ**:
- 19:00-19:15 200V充電開始（IG-OFF状態、tsu_igon_time=18:30:00）
- 19:15 充電中にIG-ON更新（tsu_igon_time=19:15:00）
- 19:15-19:30 充電継続（位置変化なし）
- 19:30 充電終了
- 19:35 IG-ON更新（tsu_igon_time=19:35:00）
- 19:35-19:50 移動開始
**期待結果**:
- 充電セッションは継続して認識
- IG-ON更新があっても位置変化がないため移動セッションにならない
- 充電終了後の移動は正しく検出

### TC012: 充電中にIG-ON更新（移動ありパターン） (VIN002)
**目的**: 充電中のIG-ON更新で移動が発生する場合の処理テスト
**シナリオ**:
- 20:00-20:15 Fast充電開始（IG-OFF状態、tsu_igon_time=19:45:00）
- 20:15 充電中にIG-ON更新（tsu_igon_time=20:15:00）
- 20:15-20:30 充電継続（位置変化なし）
- 20:30 充電終了
- 20:35 IG-ON更新（tsu_igon_time=20:35:00）、移動開始
- 20:35-21:05 移動中
- 21:05 IG-ON更新（tsu_igon_time=21:05:00）
- 21:05-21:25 移動継続
**期待結果**:
- 充電セッション中のIG-ON更新を適切に処理
- 充電終了後の移動セッションを正確に検出
- 複数のIG-ON更新がある移動セッションの継続

### TC013: 長期間放置なしパターン (VIN003)
**目的**: 充電開始から次の充電開始まで長期間放置が存在しない場合
**シナリオ**:
- 22:00-22:30 100V充電（約1.5時間）
- 22:35 充電終了
- その後のデータなし（短時間で次の行動、長期放置なし）
**期待結果**:
- 長期間放置フラグが立たない
- `is_no_move_after_charge`の適切な判定
- 短時間データでも正常処理

### TC014: データ終端での充電開始 (VIN001)
**目的**: hashvinの最後のデータで充電開始から次の充電開始データが存在しない場合
**シナリオ**:
- 08:00-08:25 Fast充電（VIN001の最終データ群）
- 08:30 充電終了
- その後のデータが存在しない（データ終端）
**期待結果**:
- データ終端での適切な処理
- 不完全セッションのエラーハンドリング
- 最終充電セッションの正確な検出

## 既存テストケース (TC001-TC010)

### TC001: 基本充電→移動→放置パターン (VIN001)
- 09:00-09:30 100V普通充電（IG-OFF）
- 09:35-10:00 移動（IG-ON）
- 10:00-14:00 長時間放置（データギャップ）

### TC002: 充電→放置→充電パターン (VIN001)
- 14:00-14:25 200V充電
- 14:25-16:30 放置（充電後移動なし）
- 16:30-17:05 再度200V充電

### TC003: 充電→移動→短時間放置→IG-ONパターン (VIN001)
- 17:00-17:20 Fast充電
- 17:25-17:40 移動中
- 17:42-17:50 短時間アイドリング

### TC004: 複雑な充電ギャップパターン (VIN002)
- 08:00-08:50 Fast充電（5分中断含む）
- 08:55-09:05 移動

### TC005: 長時間連続使用パターン (VIN002)
- 09:00-18:20 1日を通した複雑な使用パターン

### TC006: SOC変化による充電判定 (VIN002)
- 18:20-18:35 SOC上昇での充電判定

### TC007: 境界イベント同時発生 (VIN003)
- 10:00-10:25 Fast充電
- 10:30 充電終了と移動開始同時

### TC008: GPS精度ブレテスト (VIN003)
- 11:00-11:30 GPS微小変動での誤判定防止

### TC009: 短距離移動判定テスト (VIN003)
- 12:00-12:15 距離閾値による移動判定

### TC010: データ終端処理 (VIN003)
- 15:00-15:25 最後の充電

## 新規追加項目の検証ポイント

### 1. 充電中IG-ON更新処理
- **検証項目**: 充電セッション継続性
- **期待動作**: IG-ON更新があっても充電セッションとして継続
- **境界条件**: 位置変化の有無による移動判定の差異

### 2. 長期間放置なしケース
- **検証項目**: 長期放置フラグの適切な制御
- **期待動作**: 短時間データでも正常な判定
- **品質保証**: 時間閾値による分類の精度

### 3. データ終端処理
- **検証項目**: 不完全データの安全な処理
- **期待動作**: エラーなしでの処理完了
- **堅牢性**: 予期しないデータ終了への対応

## 全体設計原則

### データ完全性
- **全項目値存在**: 欠損データなし
- **IG-OFF表現**: `tsu_igon_time`値変化による推測
- **時系列整合**: 論理的な時間経過

### 実用性重視
- **実際のパターン**: 現実的なEV使用ケース
- **境界条件**: エッジケースの網羅
- **スケーラビリティ**: 大規模データ対応

### 品質保証
- **3車両**: 独立性テスト
- **14ケース**: 包括的カバレッジ
- **検証可能**: 結果予測と照合
